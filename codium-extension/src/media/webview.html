<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <style>
    body {
      font: 13px/1.4 var(--vscode-font-family);
      color: var(--vscode-foreground);
      margin: 0; padding: 0;
      height: 100%;
      display: flex; flex-direction: column;
    }
    #log {
      flex: 1; overflow-y: auto;
      padding: 12px;
      background: var(--vscode-editor-background);
      border-bottom: 1px solid var(--vscode-editorWidget-border);
    }
    .msg { margin: 8px 0; }
    .me { color: var(--vscode-textLink-foreground); }
    .ai { }
    .err { color: var(--vscode-errorForeground); }

    #inputBar {
      display: flex; align-items: center;
      padding: 8px;
      background: var(--vscode-sideBar-background);
      border-top: 1px solid var(--vscode-editorWidget-border);
    }

    #modelSelect {
      margin-right: 8px;
      padding: 6px;
      background: var(--vscode-editor-background);
      color: var(--vscode-foreground);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      font: 13px var(--vscode-font-family);
    }

    #currentFile {
      margin-right: 8px;
      padding: 6px;
      background: var(--vscode-editor-background);
      color: var(--vscode-foreground);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      font: 13px var(--vscode-font-family);
    }

    #add-thread-btn {
      margin-right: 8px;
      padding: 6px;
      background: var(--vscode-editor-background);
      color: var(--vscode-foreground);
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px;
      font: 13px var(--vscode-font-family);
      pointer-events: auto;
      -webkit-user-select: none;
    }

    #q{
      flex:1;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid var(--vscode-editorWidget-border);
      background:var(--vscode-editor-background);
      color:var(--vscode-foreground);
      resize:none;
      overflow:hidden;           /* no scrollbar */
      min-height:44px;
      max-height:160px;          /* stop growing after this */
      line-height:1.4;
      font:13px var(--vscode-font-family);
    }

    #q:focus { outline: none; border-color: var(--vscode-focusBorder); }
    #sendBtn {
      background: transparent;
      border: none;
      cursor: pointer;
      margin-left: 8px;
      padding: 4px;
    }
    #sendBtn svg {
      fill: var(--vscode-textLink-foreground);
      width: 20px; height: 20px;
    }
    #applyFix {
      display:none;
      margin: 8px; padding: 6px 10px;
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    #applyFix:hover { background: var(--vscode-button-hoverBackground); }

    /* Preserve line breaks for user text */
    pre.usertext {
      margin: 0;
      white-space: pre-wrap;
      font: 13px var(--vscode-font-family);
      background: transparent;
      border: 0;
      padding: 0;
    }

    /* User messages */
    .msg.me{
      background: rgba(0,122,204,0.08);
      border:1px solid var(--vscode-textLink-foreground);
      border-radius:8px;
      padding:10px 12px;
      margin:10px 0;
    }
    .msg.me strong {
      color: var(--vscode-textLink-foreground);
      font-weight: 600;
    }

    /* AI messages */
    .msg.ai{
      background: var(--vscode-editorWidget-background);
      border:1px solid var(--vscode-editorWidget-border);
      border-radius:8px;
      padding:10px 12px;
      margin:10px 0;
    }
    .msg.ai strong {
      color: var(--vscode-foreground);
      font-weight: 600;
    }

    .speaker{
      font-size:12px; letter-spacing:.4px; opacity:.7; text-transform:uppercase; margin-bottom:6px;
    }

    /* Code window card */
    .codecard {
      border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 8px;
      overflow: hidden;
      margin: 8px 0;
      background: var(--vscode-editor-background);
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }
    .codecard-head {
      display:flex; align-items:center; justify-content:space-between;
      padding: 6px 8px;
      background: var(--vscode-editorWidget-background);
      border-bottom: 1px solid var(--vscode-editorWidget-border);
      font-size: 12px;
    }
    .dots { display:flex; gap:6px; }
    .dot { width:10px; height:10px; border-radius:50%; }
    .dot.red    { background:#ff5f57; }
    .dot.yellow { background:#febc2e; }
    .dot.green  { background:#28c840; }
    .lang { opacity:.7 }
    .cc-actions button {
      background: transparent; border: 1px solid var(--vscode-editorWidget-border);
      border-radius: 4px; padding: 2px 8px; cursor: pointer;
      color: var(--vscode-foreground);
    }
    .cc-actions button:hover { background: var(--vscode-editorWidget-background); }
    .codecard pre {
      margin:0; padding:10px 12px; overflow:auto; font: 12px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    }
  </style>
</head>
<body>
  <div id="log"></div>
  <div id="applyFix">ðŸ’¡ Apply Fix to Editor</div>
  <div>
    <select id="modelSelect">
      <option value="openai/gpt-oss-20b:free" data-provider="openrouter">OpenRouter Â· GPT-OSS-20B</option>
      <option value="glm-4.5-flash" data-provider="zai">Z.ai Â· GLM-4.5-Flash</option>
    </select>
      <span id="currentFile">
        (no File)
      </span>
        Thread: 
      <span id="threadHint">new</span>
      <button id="add-thread-btn" title="New thread" style="z-index: 20; cursor: pointer;">
        ï¼‹
      </button>
  </div>
  <div id="inputBar">
    <textarea id="q" placeholder="Ask AJ AI about your codeâ€¦"></textarea>
    <button id="sendBtn" title="Send">
      <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
    </button>
  </div>
  <script src="main.js"></script>
</body>
</html>
